"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,e){this.store=e,this.attributes={},this.relationships={},this.meta={},this.links={},this.merge(t)}return t.prototype.identifier=function(){return{id:this.id,type:this.type}},t.prototype.merge=function(t){var e=this;if("type"in t&&(this.type=t.type),"id"in t&&(this.id=t.id),"attributes"in t&&(Object.assign(this.attributes,t.attributes),Object.keys(t.attributes).forEach((function(t){Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t)||Object.defineProperty(e,t,{configurable:!0,get:function(){return e.attributes[t]}})}))),"relationships"in t)for(var r=function(t,r){i.relationships[t]=i.relationships[t]||{},Object.assign(i.relationships[t],r),Object.getOwnPropertyDescriptor(Object.getPrototypeOf(i),t)||Object.defineProperty(i,t,{configurable:!0,get:function(){return e.store.find(e.relationships[t].data)}})},i=this,n=0,o=Object.entries(t.relationships);n<o.length;n++){var s=o[n];r(s[0],s[1])}"links"in t&&(this.links=t.links),"meta"in t&&(this.meta=t.meta)},t}(),e=function(){function e(t){void 0===t&&(t={}),this.models=t,this.graph={}}return e.prototype.model=function(t,e){this.models[t]=e},e.prototype.find=function(t,e){var r=this;return null===t?null:Array.isArray(t)?t.map((function(t){return r.find(t)})):"object"==typeof t?this.find(t.type,t.id):this.graph[t]&&this.graph[t][e]||null},e.prototype.findAll=function(t){var e=this;return this.graph[t]?Object.keys(this.graph[t]).map((function(r){return e.graph[t][r]})):[]},e.prototype.sync=function(t){var e=this.syncResource.bind(this);return"included"in t&&t.included.map(e),Array.isArray(t.data)?t.data.map(e):e(t.data)},e.prototype.syncResource=function(t){var e=t.type,r=t.id;return this.graph[e]=this.graph[e]||{},this.graph[e][r]?this.graph[e][r].merge(t):this.graph[e][r]=this.createModel(t),this.graph[e][r]},e.prototype.createModel=function(e){return new(this.models[e.type]||this.models["*"]||t)(e,this)},e.prototype.forget=function(t){delete this.graph[t.type][t.id]},e.prototype.reset=function(){this.graph={}},e}();function r(t){return encodeURIComponent(t).replace(/[!'()*]/g,(function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()}))}var i=function(){function t(t){void 0===t&&(t={}),this.query=Object.assign({},t)}return t.prototype.push=function(t,e){var r=this;return"object"==typeof t?Object.entries(t).map((function(t){return r.push.apply(r,t)})):!function(t){return"include"===t||/fields\[[^\]]+]/i.test(t)}(t)?this.query[t]=e:this.query[t]=(this.query[t]?this.query[t]+",":"")+e,this},t.prototype.toString=function(){return Object.entries(this.query).sort((function(t,e){return t[0].localeCompare(e[0])})).map((function(t){var e=t[0],i=t[1];return r(e)+"="+r(i)})).join("&")},t}();exports.Model=t,exports.Query=i,exports.Store=e;
